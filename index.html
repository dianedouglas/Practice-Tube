<!doctype html>
<html>
<head>
  <title>Google I/O YouTube Codelab</title>
  <link type="text/css" rel="stylesheet" href="index.css">
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="//www.google.com/jsapi"></script>
  <script type="text/javascript" src="index.js"></script>
  <script type="text/javascript" src="https://apis.google.com/js/client.js?onload=onJSClientLoad"></script>
</head>
<body>
  <div id="login-container" class="pre-auth">This application requires access to your YouTube account.
    Please <a href="#" id="login-link">authorize</a> to continue.
  </div>
  <div class="post-auth">
    <div id="message"></div>
    <div id="chart"></div>
    <div>Choose a Video:</div>
    <ul id="video-list"></ul>
  </div>
  <iframe id="existing-iframe-example"
          width="640" height="360"
          src="https://www.youtube.com/embed/_SBQvd6vY9s?enablejsapi=1"
          frameborder="0"
          style="border: solid 4px #37474F"
  ></iframe>
  <button onclick="loadVideoById()">Load</button>
  <button onclick="getLoopStartTime()">Start Loop</button>
  <button onclick="getLoopEndTime()">End Loop</button>
  <button onclick="startLooping()">Looping Go!</button>
  <button onclick="resumePlayback()">Resume Playback</button>
  <button onclick="back10()">Back 10 Seconds</button>
  <button onclick="back20()">Back 20 Seconds</button>
  <button onclick="back30()">Back 30 Seconds</button>
  <button onclick="back60()">Back 60 Seconds</button>
  <select id="playback-speeds" onchange="changePlaybackSpeed()"></select>
  <input id="find-videos" type="text">
  <button id="search" type="submit">Go</button>
  <div id="results"></div>
  <script type="text/javascript">
    var tag = document.createElement('script');
    tag.id = 'iframe-demo';
    tag.src = 'https://www.youtube.com/iframe_api';
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    var videoId = "YxgsxaFWWHQ";
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('existing-iframe-example', {
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
      });
    }
    function loadVideoById() {
      // player.cueVideoById({'videoId': id,
      //          'startSeconds': 15,
      //          'endSeconds': 60,
      //          'suggestedQuality': 'large'});

      player.cueVideoById({'videoId': videoId});
      player.playVideo();

    }
    var endTime;
    var startTime;
    function getLoopStartTime() {
      startTime = player.getCurrentTime();
    }
    function getLoopEndTime() {
      endTime = player.getCurrentTime();
      startLooping();
    }
    function startLooping() {
      player.cueVideoById({'videoId': videoId,
        'startSeconds': startTime,
        'endSeconds': endTime});
      player.playVideo();
    }
    function resumePlayback() {
      var duration = player.getDuration();
      var currentTime = player.getCurrentTime();
      player.cueVideoById({'videoId': videoId,
        'startSeconds': currentTime,
        'endSeconds': duration});
      player.playVideo();
    }
    function back10() {
      var currentTime = player.getCurrentTime();
      console.log(player.getCurrentTime());
      player.seekTo(currentTime - 10);
      console.log(player.getCurrentTime());
    }
    function back20() {
      var currentTime = player.getCurrentTime();
      player.seekTo(currentTime - 20);
    }
    function back30() {
      var currentTime = player.getCurrentTime();
      player.seekTo(currentTime - 30);
    }
    function back60() {
      var currentTime = player.getCurrentTime();
      player.seekTo(currentTime - 60);
    }
    function onPlayerReady(event) {
      document.getElementById('existing-iframe-example').style.borderColor = '#FF6D00';
      console.log(player.getAvailablePlaybackRates());
      setupPlaybackSpeedOptions();
    }
    function changeBorderColor(playerStatus) {
      var color;
      if (playerStatus == -1) {
        color = "#37474F"; // unstarted = gray
      } else if (playerStatus == 0) {
        color = "#FFFF00"; // ended = yellow
      } else if (playerStatus == 1) {
        color = "#33691E"; // playing = green
      } else if (playerStatus == 2) {
        color = "#DD2C00"; // paused = red
      } else if (playerStatus == 3) {
        color = "#AA00FF"; // buffering = purple
      } else if (playerStatus == 5) {
        color = "#FF6DOO"; // video cued = orange
      }
      if (color) {
        document.getElementById('existing-iframe-example').style.borderColor = color;
      }
    }
    function onPlayerStateChange(event) {
      changeBorderColor(event.data);
      if (event.data == 0) {
        startLooping();
      };
      if (event.data == 5) {
        console.log(player.getAvailablePlaybackRates());
        setupPlaybackSpeedOptions();
      }
    }
    function setupPlaybackSpeedOptions() {
      var options = player.getAvailablePlaybackRates();
      var menu = $('#playback-speeds').empty();
      options.forEach(function(speed){
        menu.append($('<option />').val(speed).text(speed));
      });
    }
    function changePlaybackSpeed() {
      var menu = $('#playback-speeds');
      player.setPlaybackRate(menu.val());
      console.log(menu.val());
    }
  </script>
</body>
</html>